<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rick and Morty Character Search</title>
    <link rel="stylesheet" href="test.css">
</head>
<body>
    <h1>Rick and Morty Character Search</h1>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Enter character name">
        <button onclick="searchCharacters()">Search</button>
    </div>

    <div id="results" class="results">
        <!-- Resultados de búsqueda se mostrarán aquí -->
    </div>

    <div id="pagination" class="pagination">
        <!-- Paginación se mostrará aquí -->
    </div>

    <script>
        let page = 1;
        let totalPages = 0;
        let currentPageButton = null;
        const maxButtons = 5;

        function searchCharacters() {
            const searchQuery = document.getElementById('searchInput').value.trim();

            fetch(`https://rickandmortyapi.com/api/character/?name=${searchQuery}&page=${page}`)
                .then(response => response.json())
                .then(data => displayResults(data));
        }

        function displayResults(data) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';

            data.results.forEach(character => {
                const characterDiv = document.createElement('div');
                characterDiv.classList.add('character');
                characterDiv.innerHTML = `
                    <h2>${character.name}</h2>
                    <p class="status">${highlightStatus(character.status)}</p>
                    <p>Episode: ${getFirstEpisode(character.episode)}</p>
                    <p>Origin: ${character.origin ? character.origin.name : 'Unknown'}</p>
                    <img src="${character.image}" alt="${character.name}">
                `;
                resultsContainer.appendChild(characterDiv);
            });

            totalPages = data.info.pages;
            renderPagination();
        }

        function renderPagination() {
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';

            const start = Math.max(1, page - Math.floor(maxButtons / 2));
            const end = Math.min(totalPages, start + maxButtons - 1);

            if (page > 1) {
                const prevButton = document.createElement('button');
                prevButton.textContent = 'Prev';
                prevButton.onclick = function() {
                    goToPage(page - 1);
                };
                paginationContainer.appendChild(prevButton);
            }

            for (let i = start; i <= end; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.onclick = function() {
                    goToPage(i);
                };
                paginationContainer.appendChild(button);

                // Marcar el botón de la página actual
                if (i === page) {
                    button.classList.add('active');
                    currentPageButton = button;
                }
            }

            if (page < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.textContent = 'Next';
                nextButton.onclick = function() {
                    goToPage(page + 1);
                };
                paginationContainer.appendChild(nextButton);
            }
        }

        function highlightStatus(status) {
            if (status === 'Alive') {
                return `<span class="status-alive">${status}</span>`;
            } else if (status === 'Dead') {
                return `<span class="status-dead">${status}</span>`;
            } else {
                return `<span class="status-unknown">Unknown</span>`;
            }
        }

        function getFirstEpisode(episodeList) {
            if (episodeList.length > 0) {
                const episodeUrl = episodeList[0];
                return getEpisodeNumber(episodeUrl);
            } else {
                return 'Unknown';
            }
        }

        function getEpisodeNumber(episodeUrl) {
            return episodeUrl.split('/').pop(); // Obtiene el último segmento de la URL (número de episodio)
        }

        function goToPage(pageNumber) {
            page = pageNumber;
            searchCharacters();

            // Eliminar la clase de estilo del botón anteriormente activo
            if (currentPageButton) {
                currentPageButton.classList.remove('active');
            }

            // Obtener el nuevo botón de la página actual y aplicar la clase de estilo
            currentPageButton = document.querySelector(`#pagination button:nth-child(${page})`);
            currentPageButton.classList.add('active');
        }

        // Mostrar personajes al cargar la página
        window.onload = function() {
            searchCharacters();
        };
    </script>
</body>
</html>
